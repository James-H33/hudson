From 6cda18c959ef71b018c2b7234e773a77596e12e5 Mon Sep 17 00:00:00 2001
From: Xiao-Long Chen <chenxiaolong@cxl.epac.to>
Date: Sun, 8 Sep 2013 03:16:08 -0400
Subject: [PATCH] Disable moving apps to SD if a no-sd-apps file exists

Change-Id: I24b9abee7f3004ef0606e425131225937aafed2a
---
 core/java/android/os/Environment.java | 6 ++++++
 1 file changed, 6 insertions(+)

diff --git a/core/java/android/os/Environment.java b/core/java/android/os/Environment.java
index a572215..d818cbc 100644
--- a/core/java/android/os/Environment.java
+++ b/core/java/android/os/Environment.java
@@ -240,6 +240,12 @@ public class Environment {
             String state = getExternalSdState();
             Log.v(TAG, "isExternalSdAvailableAndMounted: SD card state: " + state);
             if (state.equals(MEDIA_MOUNTED)) {
+                // Hack to allow disabling of moving apps to SD
+                String disable_path = getExternalSdVolume().getPath() + "/no-sd-apps";
+                final File temp = new File(disable_path);
+                if (temp.exists()) {
+                    return false;
+                }
                 return true;
             }
         } else {
-- 
1.8.4

